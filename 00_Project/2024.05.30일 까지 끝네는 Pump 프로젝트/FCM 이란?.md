firebase cloud messaging의 약자로 메시지를 날려주기 위해 추상화 시킨 인터페이스를 제공한다.

### 어떻게 동작하나?
사용자가 알림 허용을 하게 되면 FCM의 토큰을 발급 받을 수 있고 이것을 서버에게 전송한다. 
서버는 전송받은 토큰 값을 가지고 FCM에 요청할 때 포함시켜 요청하면 알림을 보낼 수 있다.

FCM은 앱의 키값을 식별하여 특정 스마트폰에 데이터를 전달할 수 있다.  
앱의 고유한 키 값은 Firebase에 앱을 등록하면 생성된다. 사용자가 이 앱을 설치하고 알람설정에 동의한다면, 기기의 FCM token을 얻을 수 있다. FCM의 Push는 **앱의 고유한 키 값과 각 사용자들의 token**을 통해 이루어진다.

FCM에는 두 가지 메시징 방법이 존재한다. 

### 근본적으로 FCM을 이용하는 이유는 뭘까?
그냥 Push 알림을 FCM 말고, 서버랑 계속적으로 연결해서 처리하면 되지 않음??
위처럼 생각하는 것도 좋은 방법이다. 하지만 이것은 계속적으로 처리하기 때문에 많은 배터리와 네트워크 문제가 생길 수 있다. 그러므로 클라우드 메시징 서비스를 이용해 사용자는 낮은 배터리 네트워크 만으로도 사용할 수 있다. 즉, 분산된 환경으로 개발이 쉬워진 것이다.

-> 그런데 client 단에서 메시지를 계속해서 수신하는 소프트웨어가 있다고 한다. 그러면 이것도 최적화 되어 있지 않다라고 표현할 수 있지 않나? 그런데 아마 대기업에서 만든거라서 최적화 되어 있고 이미 검증되어 있다고 봐야 할듯 그래서 너가 app push 서버를 만들고 싶다면 그냥 사용하면 된다는점을 기역하자 

### FCM의 알림 유형 
알림 메시지 : 알림 메시지는 말대로 어떠한 알림인지 표현하는 알림이고, Firebase sdk가 자동적으로 처리함
-> json 값이 사전에 정의되어 있음 




데이터 메시지  : 어떠한 값을 이벤트성으로 전달하기 위해 사용하는 것 -> 클라이언트 단에서 제어시키려먼 데이터 메시지 사용해야 함 
-> json 값을 내가 커스텀하여 보낼 수 있음 

두 유형의 최대는 4000bytes이다. 


### 사용 시나리오 

| 사용 시나리오 | 전송 방법                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 알림 메시지  | 클라이언트 앱이 백그라운드에서 실행 중일 때 FCM SDK가 앱을 대신하여 최종 사용자 기기에 메시지를 표시합니다. 그 외의 경우에는 알림이 수신될 때 앱이 포그라운드에서 실행 중이면 앱의 코드에 따라 동작이 결정됩니다. 알림 메시지에는 사용자에게 표시되는 사전 정의된 키 모음 및 맞춤 키-값 쌍의 데이터 페이로드(선택사항)가 포함됩니다. | 1. [Cloud Functions](https://firebase.google.com/docs/functions?authuser=0&hl=ko) 또는 앱 서버와 같은 신뢰할 수 있는 환경에서 [Admin SDK](https://firebase.google.com/docs/cloud-messaging/admin?authuser=0&hl=ko) 또는 [FCM 서버 프로토콜](https://firebase.google.com/docs/cloud-messaging/server?authuser=0&hl=ko#choose)을 사용하여 `notification` 키를 설정합니다. 선택사항으로 데이터 페이로드를 추가할 수 있습니다. 항상 축소형입니다.<br>    <br>    [디스플레이 알림의 예시](https://firebase.google.com/docs/cloud-messaging/send-message?authuser=0&hl=ko#example-notification-message-with-platform-specific-delivery-options)를 보고 요청 페이로드를 전송하세요.<br>    <br>2. [알림 작성기](https://console.firebase.google.com/project/_/notification?authuser=0&hl=ko) 사용: 메시지 본문, 제목 등을 입력하고 전송합니다. 커스텀 데이터를 제공하여 선택사항인 데이터 페이로드를 추가합니다. |
| 데이터 메시지 | 클라이언트 앱이 데이터 메시지 처리를 담당합니다. 데이터 메시지에는 예약 키 이름 없이 커스텀 키-값 쌍만 있습니다(아래 참조).                                                                                                                       | [Cloud Functions](https://firebase.google.com/docs/functions?authuser=0&hl=ko) 또는 앱 서버와 같은 신뢰할 수 있는 환경에서 [Admin SDK](https://firebase.google.com/docs/cloud-messaging/admin?authuser=0&hl=ko) 또는 [FCM 서버 프로토콜](https://firebase.google.com/docs/cloud-messaging/server?authuser=0&hl=ko#choose)을 사용하여 `data` 키만 설정합니다.                                                                                                                                                                                                                                                                                                                                                                                                                                  |

### 클라이언트에서는?
이게 보니깐 클라이언트가 알림을 울리는 식으로 구현이 되어 있다. 그니깐 연결지향으로 계속 연결하고 요청이 나한테 날라오면 그것을 callback으로 처리하여 알림으로 울려주는 것이다. 그니깐 앱 개발자가 알림을 표현할 수 있다는 것이다. 그래서 나는 어떤 이벤트가 발생헀을 때 연결지향적으로 연결되어 있는 폰에 요청을 보내면 끝이다!

### 아키텍처 
![[firebase architecture.png]]



### Firebase로 메시지 보내는 과정 
Firebase 프로젝트 설정에서 토큰 키 생성 가능 
![[Screenshot 2024-05-07 at 2.57.43 PM.png]]

https://console.firebase.google.com/u/0/project/pump-9d4dd/settings/serviceaccounts/adminsdk?hl=ko
### 용어 정리 
프로그래매틱 방식이란 
코드나 프로그램을 사용하여 작업을 자동화 하거나 제어하는 방식을 의미한다. 
Go 언어 코드로 rest api 서버를 호출하는 경우 프로그래매틱하다고 할 수 있다. 


< 좋은 참고 사이트 >
https://zuminternet.github.io/FCM-PUSH/